# ~/.tmux.conf

# Remap prefix from Ctrl+b to Ctrl+z
unbind C-b
set-option -g prefix C-z
bind-key C-z send-prefix

# Swap c and t bindings (c=clock, t=new window)
bind-key t new-window -c "#{pane_current_path}"
bind-key c clock-mode
bind-key '"' split-window -c "#{pane_current_path}"
bind-key % split-window -h -c "#{pane_current_path}"

set -g @plugin 'tmux-plugins/tpm' # mandatory
set -g @plugin 'tmux-plugins/tmux-sensible' # optional recommended

# Themes and colors
set -g @plugin 'egel/tmux-gruvbox'
set -g @tmux-gruvbox 'dark' # or 'dark256', 'light', 'light256'
# Restore gruvbox colors after #{prefix_highlight} (plugin appends #[default] which resets colors)
# Truncate path to 30 chars from the left so the clock stays visible
set -g @tmux-gruvbox-right-status-x '#{prefix_highlight}#[bg=#504945,fg=#a89984]#{=-30:#{s|/home/lenovo|~|:pane_current_path}}'
set -g @tmux-gruvbox-right-status-y '%A %Y-%m-%d'

# set -g @tmux-gruvbox-right-status-z '%H:%M '
# Add battery percentage
# set -g @tmux-gruvbox-right-status-z '#(cat /sys/class/power_supply/BAT0/capacity 2>/dev/null || cat /sys/class/power_supply/BAT1/capacity 2>/dev/null || echo "N/A")%% %H:%M '
set -g @tmux-gruvbox-right-status-z '#(echo "$(cat /sys/class/power_supply/BAT0/status 2>/dev/null)" | grep -qE "Charging|Full" && printf "⚡" ; cat /sys/class/power_supply/BAT0/capacity 2>/dev/null || cat /sys/class/power_supply/BAT1/capacity 2>/dev/null)%% %H:%M '

set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# When windows are deleted, update their “indexes”. Example:
# off:
# 1 2 3 4 5 -> 1 2 4 5
# on:
# 1 2 3 4 5 -> 1 2 3 4
set -g renumber-windows on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Windows/Panes Restoration; Configs are loaded first due to:
# https://github.com/tmux-plugins/tmux-continuum/issues/42#issuecomment-732813348
set -g @continuum-restore 'on'
set -g @continuum-save-interval '1'
set -g @continuum-boot 'on'

# set -g @plugin 'ofirgall/tmux-window-name'

set -g @plugin 'tmux-plugins/tmux-resurrect'
# Check
# https://github.com/tmux-plugins/tmux-resurrect/issues/287#issuecomment-3100533681
# for why one of user’s tmux.service’s `[ExecStop]` lines were
# disabled.

set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @resurrect-capture-pane-contents 'on'
# Special resurrect process syntax to handle flags?; Refer to
# resurrect FAQs(?) for more detailed explanations/scenarios
# set -g @resurrect-processes '"~emacsclient->emacsclient *" "docker compose up"'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# Manually added, since without this, continuum auto-save does not seem to work
run-shell /home/lenovo/.tmux/plugins/tmux-continuum/continuum.tmux
